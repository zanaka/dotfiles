---
name: review-pr
description: プルリクエストのコードレビューを支援する。PRの品質・セキュリティ・パフォーマンス・テスト・ドキュメントの観点から分析し、構造化されたレビューコメントを生成する。技術スタックは不問。
allowed-tools: Bash(gh *), Read, Grep, Glob
---
# GitHub Pull Request Review
## ステップ1: レビュー対象のPRを特定
引数の有無で対象PRを判別すること。

### 引数ありの場合
`$ARGUMENTS` をPR番号またはURLとしてそのまま使用する。

### 引数なしの場合
カレントブランチに紐づくPRを自動検出する。以下のコマンドを実行すること：

```bash
gh pr view --json number,title,url
```

- PRが見つかった場合: そのPR番号を使って以降のステップを進める。
- PRが見つからなかった場合: 「カレントブランチに紐づくPRが見つかりませんでした。PR番号を指定して `/review-pr 123` のように実行してください。」と表示して終了する。

## ステップ2: PRの情報取得

ステップ1で特定したPR（以下 `<PR>` と表記）の情報を取得すること：

```bash
gh pr view <PR>
gh pr diff <PR>
gh pr diff <PR> --name-only
gh pr view <PR> --comments
```

## ステップ3: プロジェクトの技術スタックを把握

変更されたファイルの拡張子・ディレクトリ構造・設定ファイル（package.json, Cargo.toml, go.mod, pyproject.toml, Gemfile, pom.xml, build.gradle 等）から、使用されている言語・フレームワーク・ライブラリを特定すること。

特定した技術スタックに応じて、ステップ4の各観点で注目すべきポイントを適切に調整すること。

## ステップ4: 分析の観点

プルリクエストの内容を以下の観点から分析し、コメントを作成すること。各観点において、そのプロジェクトの技術スタック固有のベストプラクティスや落とし穴も考慮に入れること。

### 1. 品質

- コードの可読性、命名の適切さ
- 設計・責務分離（関数やクラスが大きすぎないか）
- 重複コードの有無
- エラーハンドリングの適切さ
- そのプロジェクトの既存コードとの一貫性

### 2. セキュリティ

- ユーザー入力のバリデーション・サニタイズ
- 認証・認可の漏れ
- シークレットや機密情報のハードコード
- 依存ライブラリの既知の脆弱性
- その技術スタック特有のセキュリティリスク（例: SQLインジェクション, XSS, CSRF, デシリアライズ脆弱性, パストラバーサル 等）

### 3. パフォーマンス

- 不要なループやネスト、計算量の問題
- I/O・ネットワーク呼び出しの効率性
- キャッシュやメモ化の活用余地
- メモリ使用量・リソースリーク
- その技術スタック特有のパフォーマンス懸念（例: N+1クエリ, 不要な再レンダリング, GCプレッシャー 等）

### 4. テスト

- 変更に対するテストが追加・更新されているか
- エッジケースや異常系のカバー
- テストの可読性と保守性
- テストが実装の詳細に依存しすぎていないか

### 5. ドキュメント

- 変更に伴いREADMEやAPIドキュメントの更新が必要か
- 複雑なロジックに対するコード内コメントの有無
- 型定義やインターフェースの変更がドキュメントに反映されているか

## ステップ5: 出力

分析結果を以下のフォーマットで出力すること。

まずPRの全体像を出力する：

````markdown
## コードレビュー: [PR タイトル]

### 📋 PRの概要

[このPRの目的と実装内容を2-3文で簡潔に説明]

### 🛠 技術スタック

[このPRで使われている主要な言語・フレームワーク・ライブラリ]

### このPRの背景知識として抑えておくべきコードの知識

[このPRを理解するために必要なコードの知識や背景情報]

### 人間が重点的にチェックする場所

- [人間がチェックすべきポイント1（ファイルのパスも含めて）]
- [人間がチェックすべきポイント2（ファイルのパスも含めて）]

### 分かりづらい箇所の解説

- [分かりづらい箇所1の説明(ファイルのパスも含めて)]
- [分かりづらい箇所2の説明(ファイルのパスも含めて)]

### PRのリンク

[PRのリンク](PRのURL)
````

その後、発見した問題ごとに以下の形式で指摘すること。問題が見つからなかった場合は「指摘事項なし」と記載する。

````markdown
### [重大度: 高/中/低] 問題の概要

**ファイル:** path/to/file.tsx
**行:** 該当行番号

**問題:**
具体的な問題の説明

**修正案:**
修正後のコード例
````
